---
title: "Tests for Categorical Data Analysis"
author: "Felix Eßer"
date: "10/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, paged.print = FALSE)
```

## Introduction

```{r load packages, message=FALSE}
library(magittr)
library(rstatix)
library(tidyverse)
library(vcdExtra)
```

```{r load and generate data}
# data for one-sample analyses

# data for independent samples analyses

# data for dependent samples analyses
dep_data <- tibble(
  outcome = c(0,1,1,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,0,1,1,0,0,1,0,1,1,0,0,1),
  treatment = gl(3, 1, 30,labels = LETTERS[1:3]),
  participant = gl(10, 3, labels = letters[1:10])
  )
```



## Comparing an observed frequency distribution with an exepected frequency distribution

### dichotomous data
binomial test, chi-square test
### polytomous data
multinomial test, chi-square test

## Comparing independent groups regarding frequencies

### Comparing two independent groups regarding frequencies
#### dichotomous data
fisher-yates-test, chi-square test
#### polytomous data
freeman-halton-test, chi-square-test

### Comparing several independent groups regarding frequencies
chi-square-test, fuchs-kennet-outliertest

## Comparing dependent groups regarding frequencies
For this section the data `dep_data` is used:
```{r dep_data}
dep_data
```

```{r}
xtabs(~ outcome + treatment, dep_data)
```

### Comparing two dependent groups regarding frequencies
#### dichotomous data
McNemar-test, 
#### polytomous data
Marginalhomogenitätstest nach Lehmacher, Bowker-symmetry-test

### Comparing several dependent groups regarding frequencies


#### dichotomous data
Cochran's Q test can be used to compare several dependent dichotomous measurements. The package `rstatix` provides the function `cochran_qtest()`.

Assumptions of the Cochran's Q test:
1. Independent observations
2. The asymptotic test (used in the following) should be used in case of $N \times m \geq 24$. Otherwise, the exact Q-Test must be used

```{r cochran's q}
cochran_qtest(dep_data, outcome ~ treatment | participant )
```

Cochran's Q-test is significant and at least two treatmens differ, $Q(2) = 10.9, p = .004$.
To split up the significant effect pairwise McNemar tests from the package `rstatix` can be computed. In this case the p-value has to be adjusted for multiple testing (e.g., bonferroni correction).
```{r pairwise mcnemar}
pairwise_mcnemar_test(data = dep_data, formula = outcome ~ treatment | participant, 
                      type = "mcnemar", # use type="exact" if n <= 20 
                      p.adjust.method = "bonferroni")
```
The pairwise comparision showed that only treatment A and C differ significantly from each other, $p = .040$.


#### polytomous data











